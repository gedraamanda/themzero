<?php
$veiculos = get_terms( array(
	'taxonomy'   => 'categoria_veiculos',
	'hide_empty' => false,
) );

$outrasCategorias = get_terms( array(
	'taxonomy' => 'post_tag',
	'hide_empty' => false,
	'meta_query' => [[
		'key' => 'tag_sidebar'
	]],
) );

$tweets = setti_tweet_connection(4);

if ( ! is_category() ) {
    $categoria = get_the_category(get_the_ID());

	$naodeixe = new WP_Query( array(
		'posts_per_page' => 2,
		'post_type'      => 'post',
		'cat'            => $categoria[0]->term_id,
		'post_status'    => 'publish',
		'orderby'        => 'rand',
		'post__not_in'   => array( get_the_ID() )
	) );

    ?>

    <!--sidebar mobile-->
    <div class="sidebar-mobile d-block d-md-none position-fixed w-100">
        <input type="checkbox">

        <span class="open-sidebar">
            <i></i>
        </span>


        <div class="sidebar d-none px-4 py-4">
            <div class="sidebar__mais-lidas mt-3 mb-4">
                <h4 class="m-0">AS MAIS LIDAS</h4>

                <div class="mais-lidas-block d-flex flex-column">
                    <a href="#" class="text-uppercase border-bottom py-2"><span>1.</span> entrevista: yoná magalhaes</a>
                    <a href="#" class="text-uppercase border-bottom py-2"><span>3.</span> china perto do milhao</a>
                    <a href="#" class="text-uppercase border-bottom py-2"><span>4.</span> jornalista da istoé posando
                        com titulos de eleitor</a>
                </div>
            </div>

            <div class="sidebar__searchs mb-4">
                <div class="search-veiculo position-relative mb-2">
                    <div class="open d-flex border border-dark px-3 py-2">
                        <span class="w-100">VEÍCULOS</span>
                        <i></i>
                    </div>

                    <div class="search-veiculo__int text-uppercase border border-bottom-0 border-dark position-absolute w-100">
                        <div class="d-flex flex-column">
                            <?php
                            if ( ! empty( $veiculos ) ) {
	                            foreach ( $veiculos as $veiculo ) {
                                    echo '<a href="'.get_term_link($veiculo->term_id, 'categoria_veiculos').'" class="border-bottom border-dark py-2 px-3">'.$veiculo->name.'</a>';
                                }
                            }
                            ?>
                        </div>
                    </div>
                </div>

                <div class="search-data px-3 py-2">
                    <div class="d-flex">
                        <form method="get" action="<?php echo get_site_url() ?>">
                            <input type="text" placeholder="BUSCAR POR DATA" class="w-100 border-0 search-field" id="pesquisa" name="s">
                            <i></i>
                        </form>
                    </div>
                </div>
            </div>

	        <?php if ( ! empty( $naodeixe->posts ) ) { ?>
                <div class="sidebar__posts mb-3">
                    <h4 class="m-0">NÃO DEIXE DE LER</h4>

                    <?php foreach ( $naodeixe->posts as $postDeixe ) { ?>
                        <div class="posts-block py-3">
                            <a href="<?php echo get_permalink($postDeixe->ID) ?>" class="mb-0 d-block">
                                <div class="texto ">
                                    <h3 class="m-0 text-uppercase"><?php echo $postDeixe->post_title ?></h3>
                                </div>
                            </a>
                        </div>
                    <?php } ?>
                </div>
	        <?php } ?>

	        <?php  ?>
            <div class="twitter twitter-open d-flex flex-column pl-0 pb-4">
                <div class="open d-flex border border-dark px-3 py-2">
                    <i></i>
                    <span class="w-100 ml-3">TWITTER</span>
                </div>

                <div class="twitter-int px-3">
                    <?php foreach ( $tweets as $i => $tweet ) { ?>
                        <div class="twitter__block flex-column d-flex py-3 <?php echo $i != 3 ? 'border-bottom' : '' ?>">
                            <p class="m-0"><?php echo setti_convertTweet( $tweet['text'] ) ?></p>
                            <span><?php echo setti_convertTweetHour( $tweet['created_at'] ) ?></span>
                        </div>
                    <?php } ?>

                    <a href="https://twitter.com/ricardosetti" class="logo-twitter-content" target="_blank">
                        <i class="twitter"></i>
                    </a>
                </div>

            </div>
        </div>
    </div>
    <!--sidebar mobile-->

    <div class="col-md-4 col-12 d-none d-md-block">
        <div class="sidebar pl-4 pb-5">
            <div class="sidebar__searchs mb-5">
	            <?php if ( ! empty( $outrasCategorias ) ) { ?>
                    <div class="search-categorias mb-5">
                        <h4 class="m-0 mb-1">OUTRAS CATEGORIAS</h4>

                        <div class="d-flex flex-column text-uppercase">
                            <?php
                            foreach ( $outrasCategorias as $outras ) {
	                            echo '<a href="' . get_tag_link( $outras->term_id ) . '" class="border-bottom py-2 text-uppercase">' . $outras->name . ' <span>('.$outras->count.')</span></a>';
                            } ?>
                        </div>
                    </div>
	            <?php } ?>

                <div class="search-veiculo position-relative mb-2">
                    <div class="open d-flex border border-dark px-3 py-2">
                        <span class="w-100">VEÍCULOS</span>
                        <i></i>
                    </div>

                    <div class="search-veiculo__int text-uppercase border border-bottom-0 border-dark position-absolute w-100">
                        <div class="d-flex flex-column">
	                        <?php
	                        if ( ! empty( $veiculos ) ) {
		                        foreach ( $veiculos as $veiculo ) {
			                        echo '<a href="'.get_term_link($veiculo->term_id, 'categoria_veiculos').'" class="border-bottom border-dark py-2 px-3">'.$veiculo->name.'</a>';
		                        }
	                        } ?>
                        </div>
                    </div>
                </div>

                <div class="search-data px-3 py-2">
                    <div class="d-flex">
                        <form method="get" action="<?php echo get_site_url() ?>">
                            <input type="text" placeholder="BUSCAR POR DATA" class="w-100 border-0 search-field" id="pesquisa" name="s">
                            <i></i>
                        </form>
                    </div>
                </div>
            </div>

	        <?php if ( ! empty( $naodeixe->posts ) ) { ?>
                <div class="sidebar__posts mb-4">
                    <h4 class="m-0 mb-1">NÃO DEIXE DE LER</h4>

	                <?php foreach ( $naodeixe->posts as $postDeixe ) {
		                $img_destaque = get_the_post_thumbnail_url( $postDeixe->ID, 'medium' );
		                $tags         = get_the_tags( $postDeixe->ID );
		                $linha_fina   = get_field( 'intro-do-texto', $postDeixe->ID );
		                ?>

                        <div class="posts-block py-3">
                            <a href="<?php echo get_permalink( $postDeixe->ID ) ?>" class="mb-2 d-block">
                                <div class="imagem mb-2" style="background: url('<?php echo $img_destaque ?>');"></div>

                                <div class="texto ">
                                    <h3 class="m-0 text-uppercase"><?php echo $postDeixe->post_title ?></h3>

	                                <?php if ( ! empty( $linha_fina ) ) {
		                                echo '<span class="olho">' . $linha_fina . '</span>';
	                                } ?>

                                </div>
                            </a>
                        </div>
	                <?php } ?>
                </div>
	        <?php } ?>

            <div class="sidebar__mais-lidas">
                <h4 class="m-0">AS MAIS LIDAS</h4>

                <div class="mais-lidas-block d-flex flex-column">
                    <a href="#" class="text-uppercase border-bottom py-3"><span>1.</span> entrevista: yoná magalhaes</a>
                    <a href="#" class="text-uppercase border-bottom py-3"><span>3.</span> china perto do milhao</a>
                    <a href="#" class="text-uppercase border-bottom py-3"><span>4.</span> jornalista da istoé posando
                        com titulos de eleitor</a>
                </div>
            </div>
        </div>

        <div class="twitter twitter-open d-flex flex-column pl-4 pb-4">
            <div class="open d-flex border border-dark px-3 py-2">
                <i></i>
                <span class="w-100 ml-3">TWITTER</span>
            </div>

            <div class="twitter-int px-3">
	            <?php foreach ( $tweets as $i => $tweet ) { ?>
                    <div class="twitter__block flex-column d-flex py-3 <?php echo $i != 3 ? 'border-bottom' : '' ?>">
                        <p class="m-0"><?php echo setti_convertTweet( $tweet['text'] ) ?></p>
                        <span><?php echo setti_convertTweetHour( $tweet['created_at'] ) ?></span>
                    </div>
	            <?php } ?>

                <a href="https://twitter.com/ricardosetti" class="logo-twitter-content" target="_blank">
                    <i class="twitter"></i>
                </a>
            </div>

        </div>
    </div>
<?php } elseif ( is_category() ) {
		$categoria   = get_queried_object();

		$naodeixe = new WP_Query( array(
            'posts_per_page' => 2,
            'post_type'      => 'post',
            'cat'            => $categoria->term_id,
            'post_status'    => 'publish',
            'orderby'        => 'rand',
        ) ); ?>

    <!--sidebar mobile-->
    <div class="sidebar-mobile d-block d-md-none position-fixed w-100">
        <input type="checkbox">

        <span class="open-sidebar">
            <i></i>
        </span>


        <div class="sidebar d-none px-4 py-4">
            <div class="sidebar__mais-lidas mt-3 mb-4">
                <h4 class="m-0">AS MAIS LIDAS</h4>

                <div class="mais-lidas-block d-flex flex-column">
                    <a href="#" class="text-uppercase border-bottom py-2"><span>1.</span> entrevista: yoná magalhaes</a>
                    <a href="#" class="text-uppercase border-bottom py-2"><span>3.</span> china perto do milhao</a>
                    <a href="#" class="text-uppercase border-bottom py-2"><span>4.</span> jornalista da istoé posando
                        com titulos de eleitor</a>
                </div>
            </div>

            <div class="sidebar__searchs mb-4">
                <div class="search-veiculo position-relative mb-2">
                    <div class="open d-flex border border-dark px-3 py-2">
                        <span class="w-100">VEÍCULOS</span>
                        <i></i>
                    </div>

                    <div class="search-veiculo__int text-uppercase border border-bottom-0 border-dark position-absolute w-100">
                        <div class="d-flex flex-column">
	                        <?php
	                        if ( ! empty( $veiculos ) ) {
		                        foreach ( $veiculos as $veiculo ) {
			                        echo '<a href="'.get_term_link($veiculo->term_id, 'categoria_veiculos').'" class="border-bottom border-dark py-2 px-3">'.$veiculo->name.'</a>';
		                        }
	                        } ?>
                        </div>
                    </div>
                </div>

                <div class="search-data px-3 py-2">
                    <div class="d-flex">
                        <form method="get" action="<?php echo get_site_url() ?>">
                            <input type="text" placeholder="BUSCAR POR DATA" class="w-100 border-0 search-field" id="pesquisa" name="s">
                            <i></i>
                        </form>
                    </div>
                </div>
            </div>

	        <?php if ( ! empty( $naodeixe->posts ) ) { ?>
                <div class="sidebar__posts mb-3">
                    <h4 class="m-0">NÃO DEIXE DE LER</h4>

                    <?php foreach ( $naodeixe->posts as $postDeixe ) { ?>
                        <div class="posts-block py-3">
                            <a href="<?php echo get_permalink($postDeixe->ID) ?>" class="mb-0 d-block">
                                <div class="texto ">
                                    <h3 class="m-0 text-uppercase"><?php echo $postDeixe->post_title ?></h3>
                                </div>
                            </a>
                        </div>
                    <?php } ?>
                </div>
            <?php } ?>

            <div class="twitter twitter-open d-flex flex-column pl-0 pb-4">
                <div class="open d-flex border border-dark px-3 py-2">
                    <i></i>
                    <span class="w-100 ml-3">TWITTER</span>
                </div>

                <div class="twitter-int px-3">
	                <?php foreach ( $tweets as $i => $tweet ) { ?>
                        <div class="twitter__block flex-column d-flex py-3 <?php echo $i != 3 ? 'border-bottom' : '' ?>">
                            <p class="m-0"><?php echo setti_convertTweet( $tweet['text'] ) ?></p>
                            <span><?php echo setti_convertTweetHour( $tweet['created_at'] ) ?></span>
                        </div>
	                <?php } ?>

                    <a href="https://twitter.com/ricardosetti" class="logo-twitter-content" target="_blank">
                        <i class="twitter"></i>
                    </a>
                </div>

            </div>
        </div>
    </div>
    <!--sidebar mobile-->

    <div class="col-4 d-none d-md-block">
        <div class="twitter twitter-open d-flex flex-column pl-4 pb-2 border-bottom-0">
            <div class="open d-flex border border-dark px-3 py-2">
                <i></i>
                <span class="w-100 ml-3">TWITTER</span>
            </div>

            <div class="twitter-int px-3">
	            <?php foreach ( $tweets as $i => $tweet ) { ?>
                    <div class="twitter__block flex-column d-flex py-3 <?php echo $i != 3 ? 'border-bottom' : '' ?>">
                        <p class="m-0"><?php echo setti_convertTweet( $tweet['text'] ) ?></p>
                        <span><?php echo setti_convertTweetHour( $tweet['created_at'] ) ?></span>
                    </div>
	            <?php } ?>

                <a href="https://twitter.com/ricardosetti" class="logo-twitter-content" target="_blank">
                    <i class="twitter"></i>
                </a>
            </div>

        </div>

        <div class="sidebar sidebar-archive pl-4 pb-5">
            <div class="sidebar__searchs mb-4">
                <div class="search-veiculo position-relative mb-2">
                    <div class="open d-flex border border-dark px-3 py-2">
                        <span class="w-100">VEÍCULOS</span>
                        <i></i>
                    </div>

                    <div class="search-veiculo__int text-uppercase border border-bottom-0 border-dark position-absolute w-100">
                        <div class="d-flex flex-column">
	                        <?php
	                        if ( ! empty( $veiculos ) ) {
		                        foreach ( $veiculos as $veiculo ) {
			                        echo '<a href="'.get_term_link($veiculo->term_id, 'categoria_veiculos').'" class="border-bottom border-dark py-2 px-3">'.$veiculo->name.'</a>';
		                        }
	                        } ?>
                        </div>
                    </div>
                </div>

                <div class="search-data px-3 py-2">
                    <div class="d-flex">
                        <form method="get" action="<?php echo get_site_url() ?>">
                            <input type="text" placeholder="BUSCAR POR DATA" class="w-100 border-0 search-field" id="pesquisa" name="s">
                            <i></i>
                        </form>

                    </div>
                </div>

	            <?php if ( ! empty( $outrasCategorias ) ) { ?>
                    <div class="search-categorias mb-4 mt-5">
                        <h4 class="m-0 mb-1">OUTRAS CATEGORIAS</h4>

                        <div class="d-flex flex-column text-uppercase">
                            <?php
                            foreach ( $outrasCategorias as $outras ) {
                                echo '<a href="' . get_tag_link( $outras->term_id ) . '" class="border-bottom py-2 text-uppercase">' . $outras->name . ' <span>('.$outras->count.')</span></a>';
                            } ?>
                        </div>
                    </div>
	            <?php } ?>
            </div>
        </div>
    </div>
<?php } ?>
