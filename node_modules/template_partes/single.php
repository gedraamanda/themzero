<?php
$post_id = get_the_ID();

if ( wp_is_mobile() ) {
	$img_destaque = get_the_post_thumbnail_url( $post_id, 'large' );
} else {
	$img_destaque = get_the_post_thumbnail_url( $post_id, 'full' );
}

$categoria  = get_the_category( $post_id );
$linha_fina = get_field( 'intro-do-texto', $post_id );
$tags       = get_the_tags( $post_id );
$veiculo    = get_the_terms( $post_id, 'categoria_veiculos' );

$data_admin = get_field( 'data', $post_id );

if ( empty( $data_admin ) ) {
	$data_post = get_the_date( 'd' ) . ' de ' . get_the_date( "F" ) . ' de ' . get_the_date( 'Y' );
} else {
	$data_post = date( "d", strtotime( $data_admin ) ) . ' de ' . date_i18n( "F", strtotime( $data_admin ) ) . ' de ' . date( "Y", strtotime( $data_admin ) );
}
?>

<div class="container single mt-4 mt-md-5">
    <div class="row position-relative">
        <div class="col-md-8 col-12 pdd-mobile-0">

	        <?php if ( get_post_type( $post_id ) === 'videos' ) {
		        $videoUrl = get_post_meta( $post_id, 'endereco_do_video' );
		         ?>

                <div class="single-header-video">
                    <div class="cards mb-3">
                        <?php
                        if ( ! empty( $videoUrl ) ) {
	                        $embed_code = wp_oembed_get($videoUrl[0]); ?>

                            <div class="cards__video w-100">
		                        <?php echo $embed_code; ?>
                            </div>

                        <?php } else { ?>
                            <div class="cards__imagem w-100" style="background: url(<?php echo $img_destaque ?>)"></div>
                        <?php } ?>

                        <div class="cards__texto position-relative">
                            <div class="categoria border border-dark text-center d-inline-block py-1 px-4 position-absolute">
                                <a href="#" class="text-uppercase">internacional</a>
                            </div>

                            <div class="titulo py-5 px-4">
                                <a href="#">
                                    <h3 class="m-0 text-uppercase"><?php echo get_the_title($post_id) ?></h3>

	                                <?php if ( ! empty( $linha_fina ) ) { ?>
                                        <p class="m-0 mt-3"><?php echo $linha_fina ?></p>
	                                <?php } ?>
                                </a>
                            </div>

                            <div class="clearfix"></div>

	                        <?php if ( ! empty( $tags ) ) { ?>
                                <div class="tags py-4">
                                    <ul class="text-uppercase p-0">
				                        <?php foreach ( $tags as $i => $tag ) {
				                            if($i > 3) {
				                                continue;
                                            }
				                            ?>
                                            <li class="border border-dark mr-2 color-<?php echo $i+1 ?>">
                                                <a href="<?php echo get_tag_link( $tag->term_id ) ?>" class="text-uppercase">
							                        <?php echo $tag->name ?>
                                                </a>
                                            </li>
				                        <?php } ?>
                                    </ul>
                                </div>
	                        <?php } ?>
                        </div>
                    </div>
                </div>
            <?php } else { ?>
                <div class="single-header">
                    <div class="cards mb-3">
                        <div class="cards__imagem w-100" style="background: url(<?php echo $img_destaque ?>)"></div>

                        <div class="cards__texto position-relative">
                            <div class="categoria border border-dark text-center d-inline-block py-1 px-4">
                                <a href="<?php echo get_category_link( $categoria[0]->term_id ) ?>" class="text-uppercase"><?php echo $categoria[0]->name ?></a>
                            </div>

                            <div class="titulo py-3 px-4">
                                <a href="#">
                                    <h3 class="m-0 text-uppercase"><?php echo get_the_title($post_id) ?></h3>

	                                <?php if ( ! empty( $linha_fina ) ) { ?>
                                        <p class="m-0 mt-3"><?php echo $linha_fina ?></p>
	                                <?php } ?>
                                </a>
                            </div>

                            <div class="data px-4">
	                            <?php if ( ! empty( $veiculo ) ) { ?>
                                    <span class="assinatura text-uppercase"><?php echo $veiculo[0]->name ?> - </span>
                                <?php } ?>

                                <span class="data_post text-uppercase"><?php echo $data_post;?></span>
                            </div>

                            <?php if ( ! empty( $tags ) ) { ?>
                                <div class="tags px-4 py-3">
                                    <ul class="text-uppercase p-0">
                                        <?php foreach ( $tags as $i => $tag ) {

	                                        if ( $i > 3 ) {
		                                        continue;
	                                        } ?>

                                            <li class="border border-dark mr-2 color-<?php echo $i+1 ?>">
                                                <a href="<?php echo get_tag_link( $tag->term_id ) ?>" class="text-uppercase">
			                                        <?php echo $tag->name ?>
                                                </a>
                                            </li>
                                        <?php } ?>
                                    </ul>
                                </div>
                            <?php } ?>

                        </div>
                    </div>
                </div>
            <?php } ?>

            <div class="single-content">
                <?php
                $post = get_post();

                if ( has_blocks( $post->post_content ) ) { //nova versao
	                $blocks = parse_blocks( $post->post_content );

                    foreach ( $blocks as $block ) {
	                    if ( $block['blockName'] == 'core/image' ) {
		                    setti_image( $block );
	                    } else {
		                    echo apply_filters( 'the_content', render_block( $block ) );
	                    }
                    }

                } else {
	                $blocks = parse_blocks( $post->post_content );

	                echo apply_filters( 'the_content', $blocks[0]['innerContent'][0] );
                }
                ?>
            </div>

	        <?php comments_template(); ?>
        </div>


        <?php get_template_part('componentes/sidebar') ?>

    </div>

</div>
